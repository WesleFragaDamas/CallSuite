{# Apenas o formulário de atualização, igual ao bloco no detalhes_computador_modal_content.html #}
{% if ultimo_chamado and ultimo_chamado.status_chamado != 'resolvido' and ultimo_chamado.status_chamado != 'fechado' %}
    <hr class="my-4">
    <h5>Atualizar Chamado Aberto: #{{ ultimo_chamado.id }} - {{ ultimo_chamado.titulo }}</h5>
    <form id="form-atualizar-chamado-{{ computador.id }}" class="form-atualizar-chamado mt-3">
        {% csrf_token %}
        <input type="hidden" name="chamado_id" value="{{ ultimo_chamado.id }}">
        {# ... campos do formulário (select, textarea, button) ... #}
        <div class="mb-3">
            <label for="chamado_status-{{ computador.id }}" class="form-label">Novo Status:</label>
            <select name="status_chamado" id="chamado_status-{{ computador.id }}" class="form-select form-select-sm">
                {% for value, display_name in ultimo_chamado.STATUS_CHAMADO_CHOICES %}
                    <option value="{{ value }}" {% if ultimo_chamado.status_chamado == value %}selected{% endif %}>{{ display_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="solucao_aplicada-{{ computador.id }}" class="form-label">Solução Aplicada / Notas:</label>
            <textarea name="solucao_aplicada" id="solucao_aplicada-{{ computador.id }}" class="form-control form-control-sm" rows="3">{{ ultimo_chamado.solucao_aplicada|default:"" }}</textarea>
        </div>
        <button type="submit" class="btn btn-primary btn-sm">
            <i class="bi bi-check-lg"></i> Atualizar Chamado
        </button>
    </form>
{% elif ultimo_chamado %}
    <p class="mt-3 text-muted"><em>Último chamado (#{{ ultimo_chamado.id }}) já está {{ ultimo_chamado.get_status_chamado_display }}.</em></p>
{% else %}
    <p class="mt-3 text-muted"><em>Nenhum chamado ativo para interação.</em></p>
{% endif %}